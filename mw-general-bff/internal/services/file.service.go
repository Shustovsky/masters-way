package services

import (
	openapiStorage "mw-general-bff/apiAutogenerated/mw-storage"
	"mw-general-bff/internal/schemas"
	"net/http"
)

type FileService struct {
	fileAPI *openapiStorage.APIClient
}

func NewFileService(fileAPI *openapiStorage.APIClient) *FileService {
	return &FileService{fileAPI}
}

func (cs *FileService) UploadFile(request *http.Request, googleToken string) (*schemas.UploadFileResponse, error) {
	r := openapiStorage.ApiUploadFileRequest{
		ApiService: cs.fileAPI.FileAPI,
	}

	filePreviewRaw, _, err := cs.fileAPI.FileAPI.UploadFileStreamExecute(r, request, googleToken)
	if err != nil {
		return nil, err
	}

	return &schemas.UploadFileResponse{
		ID:         filePreviewRaw.Id,
		OwnerID:    filePreviewRaw.OwnerId,
		Name:       filePreviewRaw.Name,
		PreviewURL: filePreviewRaw.PreviewUrl,
		SrcURL:     filePreviewRaw.SrcUrl,
	}, nil
}
